#include <stdio.h>
#include <stdlib.h>
#include <string>
#include <vector>
#include <opencv2/opencv.hpp>

#include "mat_utils.h"

#if defined(_WIN32) || defined(_WIN64)
#define PRINT_OUT(...) fprintf_s(stdout, __VA_ARGS__)
#define PRINT_ERR(...) fprintf_s(stderr, __VA_ARGS__)
#else
#define PRINT_OUT(...) fprintf(stdout, __VA_ARGS__)
#define PRINT_ERR(...) fprintf(stderr, __VA_ARGS__)
#endif


static float anchors[896*4] = {
0.031250,0.031250,1.000000,1.000000,0.031250,0.031250,1.000000,1.000000,
0.093750,0.031250,1.000000,1.000000,0.093750,0.031250,1.000000,1.000000,
0.156250,0.031250,1.000000,1.000000,0.156250,0.031250,1.000000,1.000000,
0.218750,0.031250,1.000000,1.000000,0.218750,0.031250,1.000000,1.000000,
0.281250,0.031250,1.000000,1.000000,0.281250,0.031250,1.000000,1.000000,
0.343750,0.031250,1.000000,1.000000,0.343750,0.031250,1.000000,1.000000,
0.406250,0.031250,1.000000,1.000000,0.406250,0.031250,1.000000,1.000000,
0.468750,0.031250,1.000000,1.000000,0.468750,0.031250,1.000000,1.000000,
0.531250,0.031250,1.000000,1.000000,0.531250,0.031250,1.000000,1.000000,
0.593750,0.031250,1.000000,1.000000,0.593750,0.031250,1.000000,1.000000,
0.656250,0.031250,1.000000,1.000000,0.656250,0.031250,1.000000,1.000000,
0.718750,0.031250,1.000000,1.000000,0.718750,0.031250,1.000000,1.000000,
0.781250,0.031250,1.000000,1.000000,0.781250,0.031250,1.000000,1.000000,
0.843750,0.031250,1.000000,1.000000,0.843750,0.031250,1.000000,1.000000,
0.906250,0.031250,1.000000,1.000000,0.906250,0.031250,1.000000,1.000000,
0.968750,0.031250,1.000000,1.000000,0.968750,0.031250,1.000000,1.000000,
0.031250,0.093750,1.000000,1.000000,0.031250,0.093750,1.000000,1.000000,
0.093750,0.093750,1.000000,1.000000,0.093750,0.093750,1.000000,1.000000,
0.156250,0.093750,1.000000,1.000000,0.156250,0.093750,1.000000,1.000000,
0.218750,0.093750,1.000000,1.000000,0.218750,0.093750,1.000000,1.000000,
0.281250,0.093750,1.000000,1.000000,0.281250,0.093750,1.000000,1.000000,
0.343750,0.093750,1.000000,1.000000,0.343750,0.093750,1.000000,1.000000,
0.406250,0.093750,1.000000,1.000000,0.406250,0.093750,1.000000,1.000000,
0.468750,0.093750,1.000000,1.000000,0.468750,0.093750,1.000000,1.000000,
0.531250,0.093750,1.000000,1.000000,0.531250,0.093750,1.000000,1.000000,
0.593750,0.093750,1.000000,1.000000,0.593750,0.093750,1.000000,1.000000,
0.656250,0.093750,1.000000,1.000000,0.656250,0.093750,1.000000,1.000000,
0.718750,0.093750,1.000000,1.000000,0.718750,0.093750,1.000000,1.000000,
0.781250,0.093750,1.000000,1.000000,0.781250,0.093750,1.000000,1.000000,
0.843750,0.093750,1.000000,1.000000,0.843750,0.093750,1.000000,1.000000,
0.906250,0.093750,1.000000,1.000000,0.906250,0.093750,1.000000,1.000000,
0.968750,0.093750,1.000000,1.000000,0.968750,0.093750,1.000000,1.000000,
0.031250,0.156250,1.000000,1.000000,0.031250,0.156250,1.000000,1.000000,
0.093750,0.156250,1.000000,1.000000,0.093750,0.156250,1.000000,1.000000,
0.156250,0.156250,1.000000,1.000000,0.156250,0.156250,1.000000,1.000000,
0.218750,0.156250,1.000000,1.000000,0.218750,0.156250,1.000000,1.000000,
0.281250,0.156250,1.000000,1.000000,0.281250,0.156250,1.000000,1.000000,
0.343750,0.156250,1.000000,1.000000,0.343750,0.156250,1.000000,1.000000,
0.406250,0.156250,1.000000,1.000000,0.406250,0.156250,1.000000,1.000000,
0.468750,0.156250,1.000000,1.000000,0.468750,0.156250,1.000000,1.000000,
0.531250,0.156250,1.000000,1.000000,0.531250,0.156250,1.000000,1.000000,
0.593750,0.156250,1.000000,1.000000,0.593750,0.156250,1.000000,1.000000,
0.656250,0.156250,1.000000,1.000000,0.656250,0.156250,1.000000,1.000000,
0.718750,0.156250,1.000000,1.000000,0.718750,0.156250,1.000000,1.000000,
0.781250,0.156250,1.000000,1.000000,0.781250,0.156250,1.000000,1.000000,
0.843750,0.156250,1.000000,1.000000,0.843750,0.156250,1.000000,1.000000,
0.906250,0.156250,1.000000,1.000000,0.906250,0.156250,1.000000,1.000000,
0.968750,0.156250,1.000000,1.000000,0.968750,0.156250,1.000000,1.000000,
0.031250,0.218750,1.000000,1.000000,0.031250,0.218750,1.000000,1.000000,
0.093750,0.218750,1.000000,1.000000,0.093750,0.218750,1.000000,1.000000,
0.156250,0.218750,1.000000,1.000000,0.156250,0.218750,1.000000,1.000000,
0.218750,0.218750,1.000000,1.000000,0.218750,0.218750,1.000000,1.000000,
0.281250,0.218750,1.000000,1.000000,0.281250,0.218750,1.000000,1.000000,
0.343750,0.218750,1.000000,1.000000,0.343750,0.218750,1.000000,1.000000,
0.406250,0.218750,1.000000,1.000000,0.406250,0.218750,1.000000,1.000000,
0.468750,0.218750,1.000000,1.000000,0.468750,0.218750,1.000000,1.000000,
0.531250,0.218750,1.000000,1.000000,0.531250,0.218750,1.000000,1.000000,
0.593750,0.218750,1.000000,1.000000,0.593750,0.218750,1.000000,1.000000,
0.656250,0.218750,1.000000,1.000000,0.656250,0.218750,1.000000,1.000000,
0.718750,0.218750,1.000000,1.000000,0.718750,0.218750,1.000000,1.000000,
0.781250,0.218750,1.000000,1.000000,0.781250,0.218750,1.000000,1.000000,
0.843750,0.218750,1.000000,1.000000,0.843750,0.218750,1.000000,1.000000,
0.906250,0.218750,1.000000,1.000000,0.906250,0.218750,1.000000,1.000000,
0.968750,0.218750,1.000000,1.000000,0.968750,0.218750,1.000000,1.000000,
0.031250,0.281250,1.000000,1.000000,0.031250,0.281250,1.000000,1.000000,
0.093750,0.281250,1.000000,1.000000,0.093750,0.281250,1.000000,1.000000,
0.156250,0.281250,1.000000,1.000000,0.156250,0.281250,1.000000,1.000000,
0.218750,0.281250,1.000000,1.000000,0.218750,0.281250,1.000000,1.000000,
0.281250,0.281250,1.000000,1.000000,0.281250,0.281250,1.000000,1.000000,
0.343750,0.281250,1.000000,1.000000,0.343750,0.281250,1.000000,1.000000,
0.406250,0.281250,1.000000,1.000000,0.406250,0.281250,1.000000,1.000000,
0.468750,0.281250,1.000000,1.000000,0.468750,0.281250,1.000000,1.000000,
0.531250,0.281250,1.000000,1.000000,0.531250,0.281250,1.000000,1.000000,
0.593750,0.281250,1.000000,1.000000,0.593750,0.281250,1.000000,1.000000,
0.656250,0.281250,1.000000,1.000000,0.656250,0.281250,1.000000,1.000000,
0.718750,0.281250,1.000000,1.000000,0.718750,0.281250,1.000000,1.000000,
0.781250,0.281250,1.000000,1.000000,0.781250,0.281250,1.000000,1.000000,
0.843750,0.281250,1.000000,1.000000,0.843750,0.281250,1.000000,1.000000,
0.906250,0.281250,1.000000,1.000000,0.906250,0.281250,1.000000,1.000000,
0.968750,0.281250,1.000000,1.000000,0.968750,0.281250,1.000000,1.000000,
0.031250,0.343750,1.000000,1.000000,0.031250,0.343750,1.000000,1.000000,
0.093750,0.343750,1.000000,1.000000,0.093750,0.343750,1.000000,1.000000,
0.156250,0.343750,1.000000,1.000000,0.156250,0.343750,1.000000,1.000000,
0.218750,0.343750,1.000000,1.000000,0.218750,0.343750,1.000000,1.000000,
0.281250,0.343750,1.000000,1.000000,0.281250,0.343750,1.000000,1.000000,
0.343750,0.343750,1.000000,1.000000,0.343750,0.343750,1.000000,1.000000,
0.406250,0.343750,1.000000,1.000000,0.406250,0.343750,1.000000,1.000000,
0.468750,0.343750,1.000000,1.000000,0.468750,0.343750,1.000000,1.000000,
0.531250,0.343750,1.000000,1.000000,0.531250,0.343750,1.000000,1.000000,
0.593750,0.343750,1.000000,1.000000,0.593750,0.343750,1.000000,1.000000,
0.656250,0.343750,1.000000,1.000000,0.656250,0.343750,1.000000,1.000000,
0.718750,0.343750,1.000000,1.000000,0.718750,0.343750,1.000000,1.000000,
0.781250,0.343750,1.000000,1.000000,0.781250,0.343750,1.000000,1.000000,
0.843750,0.343750,1.000000,1.000000,0.843750,0.343750,1.000000,1.000000,
0.906250,0.343750,1.000000,1.000000,0.906250,0.343750,1.000000,1.000000,
0.968750,0.343750,1.000000,1.000000,0.968750,0.343750,1.000000,1.000000,
0.031250,0.406250,1.000000,1.000000,0.031250,0.406250,1.000000,1.000000,
0.093750,0.406250,1.000000,1.000000,0.093750,0.406250,1.000000,1.000000,
0.156250,0.406250,1.000000,1.000000,0.156250,0.406250,1.000000,1.000000,
0.218750,0.406250,1.000000,1.000000,0.218750,0.406250,1.000000,1.000000,
0.281250,0.406250,1.000000,1.000000,0.281250,0.406250,1.000000,1.000000,
0.343750,0.406250,1.000000,1.000000,0.343750,0.406250,1.000000,1.000000,
0.406250,0.406250,1.000000,1.000000,0.406250,0.406250,1.000000,1.000000,
0.468750,0.406250,1.000000,1.000000,0.468750,0.406250,1.000000,1.000000,
0.531250,0.406250,1.000000,1.000000,0.531250,0.406250,1.000000,1.000000,
0.593750,0.406250,1.000000,1.000000,0.593750,0.406250,1.000000,1.000000,
0.656250,0.406250,1.000000,1.000000,0.656250,0.406250,1.000000,1.000000,
0.718750,0.406250,1.000000,1.000000,0.718750,0.406250,1.000000,1.000000,
0.781250,0.406250,1.000000,1.000000,0.781250,0.406250,1.000000,1.000000,
0.843750,0.406250,1.000000,1.000000,0.843750,0.406250,1.000000,1.000000,
0.906250,0.406250,1.000000,1.000000,0.906250,0.406250,1.000000,1.000000,
0.968750,0.406250,1.000000,1.000000,0.968750,0.406250,1.000000,1.000000,
0.031250,0.468750,1.000000,1.000000,0.031250,0.468750,1.000000,1.000000,
0.093750,0.468750,1.000000,1.000000,0.093750,0.468750,1.000000,1.000000,
0.156250,0.468750,1.000000,1.000000,0.156250,0.468750,1.000000,1.000000,
0.218750,0.468750,1.000000,1.000000,0.218750,0.468750,1.000000,1.000000,
0.281250,0.468750,1.000000,1.000000,0.281250,0.468750,1.000000,1.000000,
0.343750,0.468750,1.000000,1.000000,0.343750,0.468750,1.000000,1.000000,
0.406250,0.468750,1.000000,1.000000,0.406250,0.468750,1.000000,1.000000,
0.468750,0.468750,1.000000,1.000000,0.468750,0.468750,1.000000,1.000000,
0.531250,0.468750,1.000000,1.000000,0.531250,0.468750,1.000000,1.000000,
0.593750,0.468750,1.000000,1.000000,0.593750,0.468750,1.000000,1.000000,
0.656250,0.468750,1.000000,1.000000,0.656250,0.468750,1.000000,1.000000,
0.718750,0.468750,1.000000,1.000000,0.718750,0.468750,1.000000,1.000000,
0.781250,0.468750,1.000000,1.000000,0.781250,0.468750,1.000000,1.000000,
0.843750,0.468750,1.000000,1.000000,0.843750,0.468750,1.000000,1.000000,
0.906250,0.468750,1.000000,1.000000,0.906250,0.468750,1.000000,1.000000,
0.968750,0.468750,1.000000,1.000000,0.968750,0.468750,1.000000,1.000000,
0.031250,0.531250,1.000000,1.000000,0.031250,0.531250,1.000000,1.000000,
0.093750,0.531250,1.000000,1.000000,0.093750,0.531250,1.000000,1.000000,
0.156250,0.531250,1.000000,1.000000,0.156250,0.531250,1.000000,1.000000,
0.218750,0.531250,1.000000,1.000000,0.218750,0.531250,1.000000,1.000000,
0.281250,0.531250,1.000000,1.000000,0.281250,0.531250,1.000000,1.000000,
0.343750,0.531250,1.000000,1.000000,0.343750,0.531250,1.000000,1.000000,
0.406250,0.531250,1.000000,1.000000,0.406250,0.531250,1.000000,1.000000,
0.468750,0.531250,1.000000,1.000000,0.468750,0.531250,1.000000,1.000000,
0.531250,0.531250,1.000000,1.000000,0.531250,0.531250,1.000000,1.000000,
0.593750,0.531250,1.000000,1.000000,0.593750,0.531250,1.000000,1.000000,
0.656250,0.531250,1.000000,1.000000,0.656250,0.531250,1.000000,1.000000,
0.718750,0.531250,1.000000,1.000000,0.718750,0.531250,1.000000,1.000000,
0.781250,0.531250,1.000000,1.000000,0.781250,0.531250,1.000000,1.000000,
0.843750,0.531250,1.000000,1.000000,0.843750,0.531250,1.000000,1.000000,
0.906250,0.531250,1.000000,1.000000,0.906250,0.531250,1.000000,1.000000,
0.968750,0.531250,1.000000,1.000000,0.968750,0.531250,1.000000,1.000000,
0.031250,0.593750,1.000000,1.000000,0.031250,0.593750,1.000000,1.000000,
0.093750,0.593750,1.000000,1.000000,0.093750,0.593750,1.000000,1.000000,
0.156250,0.593750,1.000000,1.000000,0.156250,0.593750,1.000000,1.000000,
0.218750,0.593750,1.000000,1.000000,0.218750,0.593750,1.000000,1.000000,
0.281250,0.593750,1.000000,1.000000,0.281250,0.593750,1.000000,1.000000,
0.343750,0.593750,1.000000,1.000000,0.343750,0.593750,1.000000,1.000000,
0.406250,0.593750,1.000000,1.000000,0.406250,0.593750,1.000000,1.000000,
0.468750,0.593750,1.000000,1.000000,0.468750,0.593750,1.000000,1.000000,
0.531250,0.593750,1.000000,1.000000,0.531250,0.593750,1.000000,1.000000,
0.593750,0.593750,1.000000,1.000000,0.593750,0.593750,1.000000,1.000000,
0.656250,0.593750,1.000000,1.000000,0.656250,0.593750,1.000000,1.000000,
0.718750,0.593750,1.000000,1.000000,0.718750,0.593750,1.000000,1.000000,
0.781250,0.593750,1.000000,1.000000,0.781250,0.593750,1.000000,1.000000,
0.843750,0.593750,1.000000,1.000000,0.843750,0.593750,1.000000,1.000000,
0.906250,0.593750,1.000000,1.000000,0.906250,0.593750,1.000000,1.000000,
0.968750,0.593750,1.000000,1.000000,0.968750,0.593750,1.000000,1.000000,
0.031250,0.656250,1.000000,1.000000,0.031250,0.656250,1.000000,1.000000,
0.093750,0.656250,1.000000,1.000000,0.093750,0.656250,1.000000,1.000000,
0.156250,0.656250,1.000000,1.000000,0.156250,0.656250,1.000000,1.000000,
0.218750,0.656250,1.000000,1.000000,0.218750,0.656250,1.000000,1.000000,
0.281250,0.656250,1.000000,1.000000,0.281250,0.656250,1.000000,1.000000,
0.343750,0.656250,1.000000,1.000000,0.343750,0.656250,1.000000,1.000000,
0.406250,0.656250,1.000000,1.000000,0.406250,0.656250,1.000000,1.000000,
0.468750,0.656250,1.000000,1.000000,0.468750,0.656250,1.000000,1.000000,
0.531250,0.656250,1.000000,1.000000,0.531250,0.656250,1.000000,1.000000,
0.593750,0.656250,1.000000,1.000000,0.593750,0.656250,1.000000,1.000000,
0.656250,0.656250,1.000000,1.000000,0.656250,0.656250,1.000000,1.000000,
0.718750,0.656250,1.000000,1.000000,0.718750,0.656250,1.000000,1.000000,
0.781250,0.656250,1.000000,1.000000,0.781250,0.656250,1.000000,1.000000,
0.843750,0.656250,1.000000,1.000000,0.843750,0.656250,1.000000,1.000000,
0.906250,0.656250,1.000000,1.000000,0.906250,0.656250,1.000000,1.000000,
0.968750,0.656250,1.000000,1.000000,0.968750,0.656250,1.000000,1.000000,
0.031250,0.718750,1.000000,1.000000,0.031250,0.718750,1.000000,1.000000,
0.093750,0.718750,1.000000,1.000000,0.093750,0.718750,1.000000,1.000000,
0.156250,0.718750,1.000000,1.000000,0.156250,0.718750,1.000000,1.000000,
0.218750,0.718750,1.000000,1.000000,0.218750,0.718750,1.000000,1.000000,
0.281250,0.718750,1.000000,1.000000,0.281250,0.718750,1.000000,1.000000,
0.343750,0.718750,1.000000,1.000000,0.343750,0.718750,1.000000,1.000000,
0.406250,0.718750,1.000000,1.000000,0.406250,0.718750,1.000000,1.000000,
0.468750,0.718750,1.000000,1.000000,0.468750,0.718750,1.000000,1.000000,
0.531250,0.718750,1.000000,1.000000,0.531250,0.718750,1.000000,1.000000,
0.593750,0.718750,1.000000,1.000000,0.593750,0.718750,1.000000,1.000000,
0.656250,0.718750,1.000000,1.000000,0.656250,0.718750,1.000000,1.000000,
0.718750,0.718750,1.000000,1.000000,0.718750,0.718750,1.000000,1.000000,
0.781250,0.718750,1.000000,1.000000,0.781250,0.718750,1.000000,1.000000,
0.843750,0.718750,1.000000,1.000000,0.843750,0.718750,1.000000,1.000000,
0.906250,0.718750,1.000000,1.000000,0.906250,0.718750,1.000000,1.000000,
0.968750,0.718750,1.000000,1.000000,0.968750,0.718750,1.000000,1.000000,
0.031250,0.781250,1.000000,1.000000,0.031250,0.781250,1.000000,1.000000,
0.093750,0.781250,1.000000,1.000000,0.093750,0.781250,1.000000,1.000000,
0.156250,0.781250,1.000000,1.000000,0.156250,0.781250,1.000000,1.000000,
0.218750,0.781250,1.000000,1.000000,0.218750,0.781250,1.000000,1.000000,
0.281250,0.781250,1.000000,1.000000,0.281250,0.781250,1.000000,1.000000,
0.343750,0.781250,1.000000,1.000000,0.343750,0.781250,1.000000,1.000000,
0.406250,0.781250,1.000000,1.000000,0.406250,0.781250,1.000000,1.000000,
0.468750,0.781250,1.000000,1.000000,0.468750,0.781250,1.000000,1.000000,
0.531250,0.781250,1.000000,1.000000,0.531250,0.781250,1.000000,1.000000,
0.593750,0.781250,1.000000,1.000000,0.593750,0.781250,1.000000,1.000000,
0.656250,0.781250,1.000000,1.000000,0.656250,0.781250,1.000000,1.000000,
0.718750,0.781250,1.000000,1.000000,0.718750,0.781250,1.000000,1.000000,
0.781250,0.781250,1.000000,1.000000,0.781250,0.781250,1.000000,1.000000,
0.843750,0.781250,1.000000,1.000000,0.843750,0.781250,1.000000,1.000000,
0.906250,0.781250,1.000000,1.000000,0.906250,0.781250,1.000000,1.000000,
0.968750,0.781250,1.000000,1.000000,0.968750,0.781250,1.000000,1.000000,
0.031250,0.843750,1.000000,1.000000,0.031250,0.843750,1.000000,1.000000,
0.093750,0.843750,1.000000,1.000000,0.093750,0.843750,1.000000,1.000000,
0.156250,0.843750,1.000000,1.000000,0.156250,0.843750,1.000000,1.000000,
0.218750,0.843750,1.000000,1.000000,0.218750,0.843750,1.000000,1.000000,
0.281250,0.843750,1.000000,1.000000,0.281250,0.843750,1.000000,1.000000,
0.343750,0.843750,1.000000,1.000000,0.343750,0.843750,1.000000,1.000000,
0.406250,0.843750,1.000000,1.000000,0.406250,0.843750,1.000000,1.000000,
0.468750,0.843750,1.000000,1.000000,0.468750,0.843750,1.000000,1.000000,
0.531250,0.843750,1.000000,1.000000,0.531250,0.843750,1.000000,1.000000,
0.593750,0.843750,1.000000,1.000000,0.593750,0.843750,1.000000,1.000000,
0.656250,0.843750,1.000000,1.000000,0.656250,0.843750,1.000000,1.000000,
0.718750,0.843750,1.000000,1.000000,0.718750,0.843750,1.000000,1.000000,
0.781250,0.843750,1.000000,1.000000,0.781250,0.843750,1.000000,1.000000,
0.843750,0.843750,1.000000,1.000000,0.843750,0.843750,1.000000,1.000000,
0.906250,0.843750,1.000000,1.000000,0.906250,0.843750,1.000000,1.000000,
0.968750,0.843750,1.000000,1.000000,0.968750,0.843750,1.000000,1.000000,
0.031250,0.906250,1.000000,1.000000,0.031250,0.906250,1.000000,1.000000,
0.093750,0.906250,1.000000,1.000000,0.093750,0.906250,1.000000,1.000000,
0.156250,0.906250,1.000000,1.000000,0.156250,0.906250,1.000000,1.000000,
0.218750,0.906250,1.000000,1.000000,0.218750,0.906250,1.000000,1.000000,
0.281250,0.906250,1.000000,1.000000,0.281250,0.906250,1.000000,1.000000,
0.343750,0.906250,1.000000,1.000000,0.343750,0.906250,1.000000,1.000000,
0.406250,0.906250,1.000000,1.000000,0.406250,0.906250,1.000000,1.000000,
0.468750,0.906250,1.000000,1.000000,0.468750,0.906250,1.000000,1.000000,
0.531250,0.906250,1.000000,1.000000,0.531250,0.906250,1.000000,1.000000,
0.593750,0.906250,1.000000,1.000000,0.593750,0.906250,1.000000,1.000000,
0.656250,0.906250,1.000000,1.000000,0.656250,0.906250,1.000000,1.000000,
0.718750,0.906250,1.000000,1.000000,0.718750,0.906250,1.000000,1.000000,
0.781250,0.906250,1.000000,1.000000,0.781250,0.906250,1.000000,1.000000,
0.843750,0.906250,1.000000,1.000000,0.843750,0.906250,1.000000,1.000000,
0.906250,0.906250,1.000000,1.000000,0.906250,0.906250,1.000000,1.000000,
0.968750,0.906250,1.000000,1.000000,0.968750,0.906250,1.000000,1.000000,
0.031250,0.968750,1.000000,1.000000,0.031250,0.968750,1.000000,1.000000,
0.093750,0.968750,1.000000,1.000000,0.093750,0.968750,1.000000,1.000000,
0.156250,0.968750,1.000000,1.000000,0.156250,0.968750,1.000000,1.000000,
0.218750,0.968750,1.000000,1.000000,0.218750,0.968750,1.000000,1.000000,
0.281250,0.968750,1.000000,1.000000,0.281250,0.968750,1.000000,1.000000,
0.343750,0.968750,1.000000,1.000000,0.343750,0.968750,1.000000,1.000000,
0.406250,0.968750,1.000000,1.000000,0.406250,0.968750,1.000000,1.000000,
0.468750,0.968750,1.000000,1.000000,0.468750,0.968750,1.000000,1.000000,
0.531250,0.968750,1.000000,1.000000,0.531250,0.968750,1.000000,1.000000,
0.593750,0.968750,1.000000,1.000000,0.593750,0.968750,1.000000,1.000000,
0.656250,0.968750,1.000000,1.000000,0.656250,0.968750,1.000000,1.000000,
0.718750,0.968750,1.000000,1.000000,0.718750,0.968750,1.000000,1.000000,
0.781250,0.968750,1.000000,1.000000,0.781250,0.968750,1.000000,1.000000,
0.843750,0.968750,1.000000,1.000000,0.843750,0.968750,1.000000,1.000000,
0.906250,0.968750,1.000000,1.000000,0.906250,0.968750,1.000000,1.000000,
0.968750,0.968750,1.000000,1.000000,0.968750,0.968750,1.000000,1.000000,
0.062500,0.062500,1.000000,1.000000,0.062500,0.062500,1.000000,1.000000,
0.062500,0.062500,1.000000,1.000000,0.062500,0.062500,1.000000,1.000000,
0.062500,0.062500,1.000000,1.000000,0.062500,0.062500,1.000000,1.000000,
0.187500,0.062500,1.000000,1.000000,0.187500,0.062500,1.000000,1.000000,
0.187500,0.062500,1.000000,1.000000,0.187500,0.062500,1.000000,1.000000,
0.187500,0.062500,1.000000,1.000000,0.187500,0.062500,1.000000,1.000000,
0.312500,0.062500,1.000000,1.000000,0.312500,0.062500,1.000000,1.000000,
0.312500,0.062500,1.000000,1.000000,0.312500,0.062500,1.000000,1.000000,
0.312500,0.062500,1.000000,1.000000,0.312500,0.062500,1.000000,1.000000,
0.437500,0.062500,1.000000,1.000000,0.437500,0.062500,1.000000,1.000000,
0.437500,0.062500,1.000000,1.000000,0.437500,0.062500,1.000000,1.000000,
0.437500,0.062500,1.000000,1.000000,0.437500,0.062500,1.000000,1.000000,
0.562500,0.062500,1.000000,1.000000,0.562500,0.062500,1.000000,1.000000,
0.562500,0.062500,1.000000,1.000000,0.562500,0.062500,1.000000,1.000000,
0.562500,0.062500,1.000000,1.000000,0.562500,0.062500,1.000000,1.000000,
0.687500,0.062500,1.000000,1.000000,0.687500,0.062500,1.000000,1.000000,
0.687500,0.062500,1.000000,1.000000,0.687500,0.062500,1.000000,1.000000,
0.687500,0.062500,1.000000,1.000000,0.687500,0.062500,1.000000,1.000000,
0.812500,0.062500,1.000000,1.000000,0.812500,0.062500,1.000000,1.000000,
0.812500,0.062500,1.000000,1.000000,0.812500,0.062500,1.000000,1.000000,
0.812500,0.062500,1.000000,1.000000,0.812500,0.062500,1.000000,1.000000,
0.937500,0.062500,1.000000,1.000000,0.937500,0.062500,1.000000,1.000000,
0.937500,0.062500,1.000000,1.000000,0.937500,0.062500,1.000000,1.000000,
0.937500,0.062500,1.000000,1.000000,0.937500,0.062500,1.000000,1.000000,
0.062500,0.187500,1.000000,1.000000,0.062500,0.187500,1.000000,1.000000,
0.062500,0.187500,1.000000,1.000000,0.062500,0.187500,1.000000,1.000000,
0.062500,0.187500,1.000000,1.000000,0.062500,0.187500,1.000000,1.000000,
0.187500,0.187500,1.000000,1.000000,0.187500,0.187500,1.000000,1.000000,
0.187500,0.187500,1.000000,1.000000,0.187500,0.187500,1.000000,1.000000,
0.187500,0.187500,1.000000,1.000000,0.187500,0.187500,1.000000,1.000000,
0.312500,0.187500,1.000000,1.000000,0.312500,0.187500,1.000000,1.000000,
0.312500,0.187500,1.000000,1.000000,0.312500,0.187500,1.000000,1.000000,
0.312500,0.187500,1.000000,1.000000,0.312500,0.187500,1.000000,1.000000,
0.437500,0.187500,1.000000,1.000000,0.437500,0.187500,1.000000,1.000000,
0.437500,0.187500,1.000000,1.000000,0.437500,0.187500,1.000000,1.000000,
0.437500,0.187500,1.000000,1.000000,0.437500,0.187500,1.000000,1.000000,
0.562500,0.187500,1.000000,1.000000,0.562500,0.187500,1.000000,1.000000,
0.562500,0.187500,1.000000,1.000000,0.562500,0.187500,1.000000,1.000000,
0.562500,0.187500,1.000000,1.000000,0.562500,0.187500,1.000000,1.000000,
0.687500,0.187500,1.000000,1.000000,0.687500,0.187500,1.000000,1.000000,
0.687500,0.187500,1.000000,1.000000,0.687500,0.187500,1.000000,1.000000,
0.687500,0.187500,1.000000,1.000000,0.687500,0.187500,1.000000,1.000000,
0.812500,0.187500,1.000000,1.000000,0.812500,0.187500,1.000000,1.000000,
0.812500,0.187500,1.000000,1.000000,0.812500,0.187500,1.000000,1.000000,
0.812500,0.187500,1.000000,1.000000,0.812500,0.187500,1.000000,1.000000,
0.937500,0.187500,1.000000,1.000000,0.937500,0.187500,1.000000,1.000000,
0.937500,0.187500,1.000000,1.000000,0.937500,0.187500,1.000000,1.000000,
0.937500,0.187500,1.000000,1.000000,0.937500,0.187500,1.000000,1.000000,
0.062500,0.312500,1.000000,1.000000,0.062500,0.312500,1.000000,1.000000,
0.062500,0.312500,1.000000,1.000000,0.062500,0.312500,1.000000,1.000000,
0.062500,0.312500,1.000000,1.000000,0.062500,0.312500,1.000000,1.000000,
0.187500,0.312500,1.000000,1.000000,0.187500,0.312500,1.000000,1.000000,
0.187500,0.312500,1.000000,1.000000,0.187500,0.312500,1.000000,1.000000,
0.187500,0.312500,1.000000,1.000000,0.187500,0.312500,1.000000,1.000000,
0.312500,0.312500,1.000000,1.000000,0.312500,0.312500,1.000000,1.000000,
0.312500,0.312500,1.000000,1.000000,0.312500,0.312500,1.000000,1.000000,
0.312500,0.312500,1.000000,1.000000,0.312500,0.312500,1.000000,1.000000,
0.437500,0.312500,1.000000,1.000000,0.437500,0.312500,1.000000,1.000000,
0.437500,0.312500,1.000000,1.000000,0.437500,0.312500,1.000000,1.000000,
0.437500,0.312500,1.000000,1.000000,0.437500,0.312500,1.000000,1.000000,
0.562500,0.312500,1.000000,1.000000,0.562500,0.312500,1.000000,1.000000,
0.562500,0.312500,1.000000,1.000000,0.562500,0.312500,1.000000,1.000000,
0.562500,0.312500,1.000000,1.000000,0.562500,0.312500,1.000000,1.000000,
0.687500,0.312500,1.000000,1.000000,0.687500,0.312500,1.000000,1.000000,
0.687500,0.312500,1.000000,1.000000,0.687500,0.312500,1.000000,1.000000,
0.687500,0.312500,1.000000,1.000000,0.687500,0.312500,1.000000,1.000000,
0.812500,0.312500,1.000000,1.000000,0.812500,0.312500,1.000000,1.000000,
0.812500,0.312500,1.000000,1.000000,0.812500,0.312500,1.000000,1.000000,
0.812500,0.312500,1.000000,1.000000,0.812500,0.312500,1.000000,1.000000,
0.937500,0.312500,1.000000,1.000000,0.937500,0.312500,1.000000,1.000000,
0.937500,0.312500,1.000000,1.000000,0.937500,0.312500,1.000000,1.000000,
0.937500,0.312500,1.000000,1.000000,0.937500,0.312500,1.000000,1.000000,
0.062500,0.437500,1.000000,1.000000,0.062500,0.437500,1.000000,1.000000,
0.062500,0.437500,1.000000,1.000000,0.062500,0.437500,1.000000,1.000000,
0.062500,0.437500,1.000000,1.000000,0.062500,0.437500,1.000000,1.000000,
0.187500,0.437500,1.000000,1.000000,0.187500,0.437500,1.000000,1.000000,
0.187500,0.437500,1.000000,1.000000,0.187500,0.437500,1.000000,1.000000,
0.187500,0.437500,1.000000,1.000000,0.187500,0.437500,1.000000,1.000000,
0.312500,0.437500,1.000000,1.000000,0.312500,0.437500,1.000000,1.000000,
0.312500,0.437500,1.000000,1.000000,0.312500,0.437500,1.000000,1.000000,
0.312500,0.437500,1.000000,1.000000,0.312500,0.437500,1.000000,1.000000,
0.437500,0.437500,1.000000,1.000000,0.437500,0.437500,1.000000,1.000000,
0.437500,0.437500,1.000000,1.000000,0.437500,0.437500,1.000000,1.000000,
0.437500,0.437500,1.000000,1.000000,0.437500,0.437500,1.000000,1.000000,
0.562500,0.437500,1.000000,1.000000,0.562500,0.437500,1.000000,1.000000,
0.562500,0.437500,1.000000,1.000000,0.562500,0.437500,1.000000,1.000000,
0.562500,0.437500,1.000000,1.000000,0.562500,0.437500,1.000000,1.000000,
0.687500,0.437500,1.000000,1.000000,0.687500,0.437500,1.000000,1.000000,
0.687500,0.437500,1.000000,1.000000,0.687500,0.437500,1.000000,1.000000,
0.687500,0.437500,1.000000,1.000000,0.687500,0.437500,1.000000,1.000000,
0.812500,0.437500,1.000000,1.000000,0.812500,0.437500,1.000000,1.000000,
0.812500,0.437500,1.000000,1.000000,0.812500,0.437500,1.000000,1.000000,
0.812500,0.437500,1.000000,1.000000,0.812500,0.437500,1.000000,1.000000,
0.937500,0.437500,1.000000,1.000000,0.937500,0.437500,1.000000,1.000000,
0.937500,0.437500,1.000000,1.000000,0.937500,0.437500,1.000000,1.000000,
0.937500,0.437500,1.000000,1.000000,0.937500,0.437500,1.000000,1.000000,
0.062500,0.562500,1.000000,1.000000,0.062500,0.562500,1.000000,1.000000,
0.062500,0.562500,1.000000,1.000000,0.062500,0.562500,1.000000,1.000000,
0.062500,0.562500,1.000000,1.000000,0.062500,0.562500,1.000000,1.000000,
0.187500,0.562500,1.000000,1.000000,0.187500,0.562500,1.000000,1.000000,
0.187500,0.562500,1.000000,1.000000,0.187500,0.562500,1.000000,1.000000,
0.187500,0.562500,1.000000,1.000000,0.187500,0.562500,1.000000,1.000000,
0.312500,0.562500,1.000000,1.000000,0.312500,0.562500,1.000000,1.000000,
0.312500,0.562500,1.000000,1.000000,0.312500,0.562500,1.000000,1.000000,
0.312500,0.562500,1.000000,1.000000,0.312500,0.562500,1.000000,1.000000,
0.437500,0.562500,1.000000,1.000000,0.437500,0.562500,1.000000,1.000000,
0.437500,0.562500,1.000000,1.000000,0.437500,0.562500,1.000000,1.000000,
0.437500,0.562500,1.000000,1.000000,0.437500,0.562500,1.000000,1.000000,
0.562500,0.562500,1.000000,1.000000,0.562500,0.562500,1.000000,1.000000,
0.562500,0.562500,1.000000,1.000000,0.562500,0.562500,1.000000,1.000000,
0.562500,0.562500,1.000000,1.000000,0.562500,0.562500,1.000000,1.000000,
0.687500,0.562500,1.000000,1.000000,0.687500,0.562500,1.000000,1.000000,
0.687500,0.562500,1.000000,1.000000,0.687500,0.562500,1.000000,1.000000,
0.687500,0.562500,1.000000,1.000000,0.687500,0.562500,1.000000,1.000000,
0.812500,0.562500,1.000000,1.000000,0.812500,0.562500,1.000000,1.000000,
0.812500,0.562500,1.000000,1.000000,0.812500,0.562500,1.000000,1.000000,
0.812500,0.562500,1.000000,1.000000,0.812500,0.562500,1.000000,1.000000,
0.937500,0.562500,1.000000,1.000000,0.937500,0.562500,1.000000,1.000000,
0.937500,0.562500,1.000000,1.000000,0.937500,0.562500,1.000000,1.000000,
0.937500,0.562500,1.000000,1.000000,0.937500,0.562500,1.000000,1.000000,
0.062500,0.687500,1.000000,1.000000,0.062500,0.687500,1.000000,1.000000,
0.062500,0.687500,1.000000,1.000000,0.062500,0.687500,1.000000,1.000000,
0.062500,0.687500,1.000000,1.000000,0.062500,0.687500,1.000000,1.000000,
0.187500,0.687500,1.000000,1.000000,0.187500,0.687500,1.000000,1.000000,
0.187500,0.687500,1.000000,1.000000,0.187500,0.687500,1.000000,1.000000,
0.187500,0.687500,1.000000,1.000000,0.187500,0.687500,1.000000,1.000000,
0.312500,0.687500,1.000000,1.000000,0.312500,0.687500,1.000000,1.000000,
0.312500,0.687500,1.000000,1.000000,0.312500,0.687500,1.000000,1.000000,
0.312500,0.687500,1.000000,1.000000,0.312500,0.687500,1.000000,1.000000,
0.437500,0.687500,1.000000,1.000000,0.437500,0.687500,1.000000,1.000000,
0.437500,0.687500,1.000000,1.000000,0.437500,0.687500,1.000000,1.000000,
0.437500,0.687500,1.000000,1.000000,0.437500,0.687500,1.000000,1.000000,
0.562500,0.687500,1.000000,1.000000,0.562500,0.687500,1.000000,1.000000,
0.562500,0.687500,1.000000,1.000000,0.562500,0.687500,1.000000,1.000000,
0.562500,0.687500,1.000000,1.000000,0.562500,0.687500,1.000000,1.000000,
0.687500,0.687500,1.000000,1.000000,0.687500,0.687500,1.000000,1.000000,
0.687500,0.687500,1.000000,1.000000,0.687500,0.687500,1.000000,1.000000,
0.687500,0.687500,1.000000,1.000000,0.687500,0.687500,1.000000,1.000000,
0.812500,0.687500,1.000000,1.000000,0.812500,0.687500,1.000000,1.000000,
0.812500,0.687500,1.000000,1.000000,0.812500,0.687500,1.000000,1.000000,
0.812500,0.687500,1.000000,1.000000,0.812500,0.687500,1.000000,1.000000,
0.937500,0.687500,1.000000,1.000000,0.937500,0.687500,1.000000,1.000000,
0.937500,0.687500,1.000000,1.000000,0.937500,0.687500,1.000000,1.000000,
0.937500,0.687500,1.000000,1.000000,0.937500,0.687500,1.000000,1.000000,
0.062500,0.812500,1.000000,1.000000,0.062500,0.812500,1.000000,1.000000,
0.062500,0.812500,1.000000,1.000000,0.062500,0.812500,1.000000,1.000000,
0.062500,0.812500,1.000000,1.000000,0.062500,0.812500,1.000000,1.000000,
0.187500,0.812500,1.000000,1.000000,0.187500,0.812500,1.000000,1.000000,
0.187500,0.812500,1.000000,1.000000,0.187500,0.812500,1.000000,1.000000,
0.187500,0.812500,1.000000,1.000000,0.187500,0.812500,1.000000,1.000000,
0.312500,0.812500,1.000000,1.000000,0.312500,0.812500,1.000000,1.000000,
0.312500,0.812500,1.000000,1.000000,0.312500,0.812500,1.000000,1.000000,
0.312500,0.812500,1.000000,1.000000,0.312500,0.812500,1.000000,1.000000,
0.437500,0.812500,1.000000,1.000000,0.437500,0.812500,1.000000,1.000000,
0.437500,0.812500,1.000000,1.000000,0.437500,0.812500,1.000000,1.000000,
0.437500,0.812500,1.000000,1.000000,0.437500,0.812500,1.000000,1.000000,
0.562500,0.812500,1.000000,1.000000,0.562500,0.812500,1.000000,1.000000,
0.562500,0.812500,1.000000,1.000000,0.562500,0.812500,1.000000,1.000000,
0.562500,0.812500,1.000000,1.000000,0.562500,0.812500,1.000000,1.000000,
0.687500,0.812500,1.000000,1.000000,0.687500,0.812500,1.000000,1.000000,
0.687500,0.812500,1.000000,1.000000,0.687500,0.812500,1.000000,1.000000,
0.687500,0.812500,1.000000,1.000000,0.687500,0.812500,1.000000,1.000000,
0.812500,0.812500,1.000000,1.000000,0.812500,0.812500,1.000000,1.000000,
0.812500,0.812500,1.000000,1.000000,0.812500,0.812500,1.000000,1.000000,
0.812500,0.812500,1.000000,1.000000,0.812500,0.812500,1.000000,1.000000,
0.937500,0.812500,1.000000,1.000000,0.937500,0.812500,1.000000,1.000000,
0.937500,0.812500,1.000000,1.000000,0.937500,0.812500,1.000000,1.000000,
0.937500,0.812500,1.000000,1.000000,0.937500,0.812500,1.000000,1.000000,
0.062500,0.937500,1.000000,1.000000,0.062500,0.937500,1.000000,1.000000,
0.062500,0.937500,1.000000,1.000000,0.062500,0.937500,1.000000,1.000000,
0.062500,0.937500,1.000000,1.000000,0.062500,0.937500,1.000000,1.000000,
0.187500,0.937500,1.000000,1.000000,0.187500,0.937500,1.000000,1.000000,
0.187500,0.937500,1.000000,1.000000,0.187500,0.937500,1.000000,1.000000,
0.187500,0.937500,1.000000,1.000000,0.187500,0.937500,1.000000,1.000000,
0.312500,0.937500,1.000000,1.000000,0.312500,0.937500,1.000000,1.000000,
0.312500,0.937500,1.000000,1.000000,0.312500,0.937500,1.000000,1.000000,
0.312500,0.937500,1.000000,1.000000,0.312500,0.937500,1.000000,1.000000,
0.437500,0.937500,1.000000,1.000000,0.437500,0.937500,1.000000,1.000000,
0.437500,0.937500,1.000000,1.000000,0.437500,0.937500,1.000000,1.000000,
0.437500,0.937500,1.000000,1.000000,0.437500,0.937500,1.000000,1.000000,
0.562500,0.937500,1.000000,1.000000,0.562500,0.937500,1.000000,1.000000,
0.562500,0.937500,1.000000,1.000000,0.562500,0.937500,1.000000,1.000000,
0.562500,0.937500,1.000000,1.000000,0.562500,0.937500,1.000000,1.000000,
0.687500,0.937500,1.000000,1.000000,0.687500,0.937500,1.000000,1.000000,
0.687500,0.937500,1.000000,1.000000,0.687500,0.937500,1.000000,1.000000,
0.687500,0.937500,1.000000,1.000000,0.687500,0.937500,1.000000,1.000000,
0.812500,0.937500,1.000000,1.000000,0.812500,0.937500,1.000000,1.000000,
0.812500,0.937500,1.000000,1.000000,0.812500,0.937500,1.000000,1.000000,
0.812500,0.937500,1.000000,1.000000,0.812500,0.937500,1.000000,1.000000,
0.937500,0.937500,1.000000,1.000000,0.937500,0.937500,1.000000,1.000000,
0.937500,0.937500,1.000000,1.000000,0.937500,0.937500,1.000000,1.000000,
0.937500,0.937500,1.000000,1.000000,0.937500,0.937500,1.000000,1.000000,
};


static float sigmoid(float x)
{
    return 1.0f / (1.0f + exp(-x));
}


static void decode_boxes(const cv::Mat& raw_boxes, cv::Mat& boxes)
{
    // Converts the predictions into actual coordinates using
    // the anchor boxes. Processes the entire batch at once.

    cv::Mat x_center, y_center;
    if (raw_boxes.rows > 0) {
        boxes = cv::Mat::zeros(raw_boxes.rows, raw_boxes.cols, CV_MAKETYPE(CV_32F, raw_boxes.channels()));
    }
    else {
        boxes = cv::Mat::zeros(raw_boxes.dims, raw_boxes.size, CV_MAKETYPE(CV_32F, raw_boxes.channels()));
    }

    float x_scale = 128.0f;
    float y_scale = 128.0f;
    float w_scale = 128.0f;
    float h_scale = 128.0f;

    float* rawb_data = (float*)raw_boxes.data;
    float* b_data    = (float*)boxes.data;
    for (int i = 0; i < raw_boxes.rows; i++) {
        float x_center = rawb_data[i*16+0] / x_scale * anchors[i*4+2] + anchors[i*4+0];
        float y_center = rawb_data[i*16+1] / y_scale * anchors[i*4+3] + anchors[i*4+1];

        float w = rawb_data[i*16+2] / w_scale * anchors[i*4+2];
        float h = rawb_data[i*16+3] / h_scale * anchors[i*4+3];

        b_data[i*16+0] = y_center - h / 2.0f; // ymin
        b_data[i*16+1] = x_center - w / 2.0f; // xmin
        b_data[i*16+2] = y_center + h / 2.0f; // ymax
        b_data[i*16+3] = x_center + w / 2.0f; // xmax

        for (int k = 0; k < 6; k++) {
            int offset = 4 + k*2;
            b_data[i*16+offset]   = rawb_data[i*16+offset]   / x_scale * anchors[i*4+2] + anchors[i*4+0];
            b_data[i*16+offset+1] = rawb_data[i*16+offset+1] / y_scale * anchors[i*4+3] + anchors[i*4+1];
        }
   }

    return;
}


static void intersect(const cv::Mat& box_a, const cv::Mat& box_b, cv::Mat& inter)
{
    inter = cv::Mat(1, box_b.rows, CV_32FC1);
    float* ba_data = (float*)box_a.data;
    float* bb_data = (float*)box_b.data;
    float* inter_data = (float*)inter.data;
    for (int i = 0; i < box_b.rows; i++) {
        float min_x = std::max(ba_data[1], bb_data[i*4+1]);
        float min_y = std::max(ba_data[0], bb_data[i*4+0]);
        float max_x = std::min(ba_data[3], bb_data[i*4+3]);
        float max_y = std::min(ba_data[2], bb_data[i*4+2]);
        float w = std::max(0.0f, max_x - min_x);
        float h = std::max(0.0f, max_y - min_y);
        inter_data[i] = w * h;
    }

    return;
}


static void jaccard(const cv::Mat& box_a, const cv::Mat& box_b, cv::Mat& ious)
{
    // Compute the jaccard overlap of two sets of boxes.  The jaccard overlap
    // is simply the intersection over union of two boxes.  Here we operate on
    // ground truth boxes and default boxes.

    cv::Mat inter;
    intersect(box_a, box_b, inter);

    ious = cv::Mat(1, box_b.rows, CV_32FC1);
    float* ba_data = (float*)box_a.data;
    float* bb_data = (float*)box_b.data;
    float* inter_data = (float*)inter.data;
    float* ious_data  = (float*)ious.data;
    float area_a = (ba_data[3] - ba_data[1]) * (ba_data[2] - ba_data[0]);
    for (int i = 0; i < box_b.rows; i++) {
        float area_b = (bb_data[i*4+3] - bb_data[i*4+1]) * (bb_data[i*4+2] - bb_data[i*4+0]);
        ious_data[i] = inter_data[i] / (area_a + area_b - inter_data[i]);
    }

    return;
}


static void overlap_similarity(const cv::Mat& first_box, const cv::Mat& other_boxes, cv::Mat& ious)
{
    jaccard(first_box, other_boxes, ious);

    return;
}


static void weighted_non_max_suppression(const std::vector<cv::Mat> &detections, std::vector<cv::Mat>& output_detections)
{
    if (detections.size() == 0) {
        return;
    }

    float min_suppression_threshold = 0.3f;

    std::vector<float> scores;
    for (int i = 0; i < detections.size(); i++) {
        float* det_data = (float*)detections[i].data;
        scores.push_back(det_data[16]);
    }

    // Sort the scores from highest to lowest score.
    cv::Mat mat_scores    = cv::Mat_<float>(1, scores.size(), &scores[0]);
    cv::Mat mat_remaining = cv::Mat_<int>(1, scores.size());
    cv::sortIdx(mat_scores, mat_remaining, cv::SORT_EVERY_ROW|cv::SORT_DESCENDING);
    std::vector<int> remaining;
    remaining.insert(remaining.end(), (int*)mat_remaining.data, (int*)mat_remaining.data+mat_remaining.cols);

    while (remaining.size() > 0) {
        cv::Mat detection = detections[remaining[0]];

        // Compute the overlap between the first box and the other 
        // remaining boxes. (Note that the other_boxes also include
        // the first_box.)
        cv::Mat first_box = detection.colRange(cv::Range(0, 4));
        cv::Mat other_boxes = cv::Mat(remaining.size(), 4, CV_32FC1);
        for (int i = 0; i < remaining.size(); i++) {
            cv::Rect roi(0, i, 4, 1);
            detections[remaining[i]].colRange(cv::Range(0, 4)).copyTo(other_boxes(roi));
        }
        cv::Mat ious;
        overlap_similarity(first_box, other_boxes, ious);

        // If two detections don't overlap enough, they are considered
        // to be from different faces.
        float* ious_data = (float*)ious.data;
        std::vector<int> overlapping;
        std::vector<int> next_remaining;
        for (int i = 0; i < ious.cols; i++) {
            if (ious_data[i] > min_suppression_threshold) {
                overlapping.push_back(remaining[i]);
            }
            else {
                next_remaining.push_back(remaining[i]);
            }
        }

        // Take an average of the coordinates from the overlapping
        // detections, weighted by their confidence scores.
        cv::Mat weighted_detection = detection;
        if (overlapping.size() > 1) {
            float total_score = 0.0f;
            cv::Mat sum_coordinate = cv::Mat(1, 16, CV_32FC1, 0.0f);
            for (int i = 0; i < overlapping.size(); i++) {
                float* det_data = (float*)detections[overlapping[i]].data;
                float score = det_data[16];
                total_score += score;
                cv::Mat coordinate = detections[overlapping[i]].colRange(cv::Range(0, 16));
                coordinate *= score;
                sum_coordinate += coordinate;
            }
            sum_coordinate /= total_score;
            cv::Rect roi(0, 0, 16, 1);
            sum_coordinate.copyTo(weighted_detection(roi));
            float* wdet_data = (float*)weighted_detection.data;
            wdet_data[16] = total_score / overlapping.size();
        }
        output_detections.push_back(weighted_detection);

        remaining = next_remaining;
    }

    return;
}


int blazeface_postprocess(const cv::Mat& raw_box, const cv::Mat& raw_score, std::vector<cv::Mat>& detections)
{
    float score_thresh = 100.0f;
    float min_score_thresh = 0.75f;

    // (1, 896, N) isn't currently implemented
    assert(raw_box.rows == 896);
    assert(raw_score.rows == 896);

    cv::Mat detection_boxes;
    decode_boxes(raw_box, detection_boxes); // (896, 16)

    float* raws_data = (float*)raw_score.data;
    std::vector<cv::Mat> detections0;
    for (int i = 0; i < raw_score.rows; i++) { // (896, 1)
        float score = std::min(std::max(raws_data[i], -score_thresh), score_thresh);
        float det_scores = sigmoid(score);
        if (det_scores >= min_score_thresh) {
            cv::Mat mat_boxes  = detection_boxes.rowRange(cv::Range(i, i+1));
            cv::Mat mat_scores = cv::Mat(1, 1, CV_32F, det_scores);
            cv::Mat mat_detection;
            concatenate(mat_boxes, mat_scores, mat_detection, 1);
            detections0.push_back(mat_detection);
        }
    }

    weighted_non_max_suppression(detections0, detections);

    return 0;
}
